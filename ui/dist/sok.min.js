!function(){"use strict";angular.module("myservices",[]).factory("mainSrv",["$http",function(a){var b=null,c=null;return{updateEmoticonsList:function(){a.get("/api/emoticons").success(function(a){c=a.data})},getEmoticonsList:function(){return c},setCurrentUser:function(a){b=a},getCurrentUser:function(){return b},checkLogin:function(c){a.get("/api/profile").success(function(a){b="ERROR"===a.status?null:a.data}).error(function(){b=null}).finally(function(){c()})}}}])}(),function(){"use strict";angular.module("myservices").factory("$kUtil",["$http","$filter","$parse","$compile",function(a,b,c,d){return{poweredFilter:function(a,d){return b("filter")(a,function(a){for(var b in d)if(d.hasOwnProperty(b)){var e=d[b],f=c(b)(a);if(e){if("undefined"==typeof f||null===f)return!1;if(f.toString().toLowerCase().indexOf(e.toLowerCase())<0)return!1}}return!0})},showConfirmDialog:function(b,c,e,f){var g="/ui/templates/services/dialog/confirm.dialog.template.html",h=b.$new();h.header=c,h.content=e,h.confirmCb=f;var i,j;a.get(g).success(function(a){i=angular.element(a).appendTo("body"),j=d(i)(h),j.modal("show"),j.on("hidden.bs.modal",function(){j.remove(),h.$destroy()})})}}}])}(),function(){"use strict";angular.module("KApp",["ngRoute","ngSanitize","angularFileUpload","myservices","ngTable","toaster"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/admin-cp",{templateUrl:"/ui/scripts/admin-cp/templates/admincp.template.html",controller:"AdminCpCtrl"}).when("/",{templateUrl:"/ui/scripts/questions/templates/questions.home.template.html",controller:"QuestionHomeCtrl"}).when("/view/:questionId",{templateUrl:"/ui/scripts/questions/templates/questions.home.template.html",controller:"QuestionHomeCtrl"}).when("/questions/:questionId",{templateUrl:"/ui/scripts/questions/templates/questions.home.template.html",controller:"QuestionHomeCtrl"}).when("/profile",{templateUrl:"/ui/scripts/users/templates/users.home.template.html",controller:"UserHomeCtrl"}).when("/che-anh",{templateUrl:"/ui/scripts/images/templates/images.home.template.html",controller:"ImageHomeCtrl"}).when("/che-anh/:memeId",{templateUrl:"/ui/scripts/images/templates/images.edit.template.html",controller:"ImageEditCtrl"}).when("/:viewMode",{templateUrl:"/ui/scripts/questions/templates/questions.home.template.html",controller:"QuestionHomeCtrl"}).otherwise({redirectTo:"/"}),b.html5Mode(!0)}])}(),function(){"use strict";angular.module("KApp").controller("IndexCtrl",["$scope","$http","$location","$window","mainSrv","$route","$routeParams","$timeout","$upload","$sce",function(a,b,c,d,e,f,g,h,i,j){function k(){q.loading=!0,e.checkLogin(function(){q.currentUser=e.getCurrentUser(),q.loading=!1})}function l(a){q.postError=!0,q.postErrorMsg=a,q.posting=!1,$(".modal").animate({scrollTop:0},200)}function m(){q.currentPost=angular.copy(s),t=null,q.dataUrls=[],q.imgSrc=null}function n(a){for(var b=atob(a.split(",")[1]),c=[],d=0;d<b.length;d++)c.push(b.charCodeAt(d));return new Blob([new Uint8Array(c)],{type:"image/jpeg"})}function o(c){return c&&(q.currentPost.media=c),c||q.currentPost.content&&!(q.currentPost.content.trim().length<32)?("member"===q.postingIdentity&&b.post("/api/posts/member/create",angular.toJson(q.currentPost)).success(function(){q.showPostSuccess=!0,q.postSuccessMsg="Đăng bài thành công.",m(),a.$broadcast("GET_NEWEST_QUESTION")}).error(function(a){l(a)}).finally(function(){q.posting=!1}),void("anonymous"===q.postingIdentity&&b.post("/api/posts/public/create",angular.toJson(q.currentPost)).success(function(b){"SUCCESS"===b.status&&(q.showPostSuccess=!0,q.postSuccessMsg="Đăng bài thành công.",a.$broadcast("GET_NEWEST_QUESTION")),m()}).error(function(a){l(a)}).finally(function(){q.posting=!1}))):void l("Bài viết không có hình ảnh phải có độ dài 32 ký tự trở lên !")}function p(a){var b="";return a=a.replace(/(>|<)/gi,"").split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/)/),void 0!==a[2]?(b=a[2].split(/[^0-9a-z_]/i),b=b[0]):b=a,b}var q={},r={username:"",password:"",confirmPassword:"",email:""};q.currentLoginInfo={},q.currentRegisterInfo=angular.copy(r),q.currentUser=null,k(),q.logout=function(){b.get("/api/logout").success(function(){a.$broadcast("LOGGED_OUT"),f.reload(),k(),e.setCurrentUser(null)})},q.login=function(){b.post("/api/users/login",angular.toJson(q.currentLoginInfo)).success(function(){q.currentLoginInfo={},k()}).error(function(){k()})},q.signUp=function(){b.post("/api/users/signup",angular.toJson(q.currentRegisterInfo)).success(function(){q.currentRegisterInfo=angular.copy(r),k()}).error(k)},q.facebookLogin=function(){d.location.href="/api/auth/facebook"},q.googleLogin=function(){d.location.href="/api/auth/google"},q.title="Xả Stress",q.showPost=function(){a.$broadcast("WANT_TO_POST")};var s={title:"",content:"",media:null,category:"funny"};q.CATEGORY_TYPES=[{name:"Vui Nhộn",key:"funny"},{name:"Gái Xinh",key:"girl"},{name:"Trai Đẹp",key:"boy"}],q.MEDIA_TYPES={YOUTUBE:"youtube",IMAGE:"image"},q.currentPost=angular.copy(s),q.postingIdentity="member",q.postingMediaType=q.MEDIA_TYPES.IMAGE,q.checkLogin=function(){e.checkLogin(function(){q.currentUser=e.getCurrentUser(),q.postingIdentity=q.currentUser?"member":"anonymous"})},q.dataUrls=[];var t;q.onFileSelect=function(a){q.imgSrc=null,t=a;var b=new FileReader;b.readAsDataURL(a[0]),b.onload=function(a){h(function(){q.dataUrls[0]=a.target.result})}},q.showPostForm=function(){q.showPostSuccess=!1},q.onShowingPostForm=function(){q.checkLogin(),q.showPostForm()},q.post=function(){if(!q.currentPost.title||""===q.currentPost.title.trim())return void l("Tiêu đề bài viết không thể để trống !");if(q.posting=!0,q.postingMediaType===q.MEDIA_TYPES.IMAGE)if(t&&t[0]||q.imgSrc){var a={url:"/api/files/images/upload",method:"post",headers:{"my-header":"my-header-value"},data:{myModel:"",errorCode:500,errorMessage:"Error"},file:q.imgSrc?n(q.imgSrc):t[0],fileFormDataName:"myFile"};q.imgSrc&&(a.fileName="myFile.jpg"),i.upload(a).then(function(a){var b=a.data.data;o(b)},function(a){l(a.data)})}else o();else if(q.youtubeRawUrl){var b={media_type:"video/youtube",youtubeId:p(q.youtubeRawUrl)};o(b)}else o()},a.$watch("index.youtubeRawUrl",function(a){a&&(q.youtubeUrl=j.trustAsResourceUrl("https://www.youtube.com/embed/"+p(a)))}),q.toHomePage=function(){c.url("/"),f.reload()},e.updateEmoticonsList(),a.$on("TITLE_CHANGED",function(a,b){q.title=b}),a.$on("VIEW_MODE_CHANGED",function(a,b){q.currentViewMode=b}),a.$on("LOGGED_IN",function(){q.currentUser=e.getCurrentUser()}),a.index=q}])}(),function(){angular.module("KApp").directive("showDialog",["$http","$compile","$parse",function(a,b,c){return{restrict:"A",link:function(d,e,f){var g;f.onShow&&(g=c(f.onShow)(d)),e.bind("click",function(){"function"==typeof g&&g(),a.get(f.showDialog).success(function(a){var c=$(a).appendTo("body");b(c.contents())(d),c.modal("show"),c.on("hidden.bs.modal",function(){c.remove()})})})}}}]).directive("popOver",["$http","$compile",function(a,b){return{restrict:"A",link:function(c,d,e){var f='<div style="position: fixed; top: 0; bottom: 0; left:0; right: 0; z-index:98"></div>';a.get(e.popOver).success(function(a){var g=b(a)(c);$(d).popover({placement:function(){var a=$(d).offset().top,b=a-$(window).scrollTop();return 500>b?"bottom":"top"},container:"body",title:e.popOverTitle,template:g,content:function(){return b(g.find(".popover-content").html())(c)},html:!0,trigger:"manual"}),d.bind("click",function(){d.popover("show");var a=$(f).appendTo("body"),b=g.find(".popover-close");a.on("click",function(){a.remove(),d.popover("hide"),b.off("click")}),b.on("click",function(){a&&(a.remove(),d.popover("hide"),b.off("click"))})})})}}}]).directive("lazyLoad",["$window","$document","$parse",function(a,b,c){return function(d,e,f){var g=angular.element(a),h=angular.element(b);g.bind("scroll",function(){var a=e.offset().top,b=h.height()-e.height()-a,i=d[f.fixedFooterHeight];i||(i=0),g.scrollTop()+g.height()>=h.height()-b+i&&!c(f.isLoading)(d)&&d.$apply(f.lazyLoad)})}}]).directive("bindCkeditor",["$timeout",function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){var e={},f="mini"===c.bindCkeditor,g=Number(c.bindCkeditor);e.toolbar="mini"!==c.bindCkeditor?[{name:"document",groups:["mode","document","doctools"],items:["Source","-","Save","NewPage","Preview","Print","-","Templates"]},{name:"basicstyles",groups:["basicstyles","cleanup"],items:["Bold","Italic","Underline","Strike","Subscript","Superscript","-","RemoveFormat"]},{name:"paragraph",groups:["list","indent","blocks","align","bidi"],items:["NumberedList","BulletedList","-","Outdent","Indent","-","Blockquote","CreateDiv","-","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock","-","BidiLtr","BidiRtl","Language"]},{name:"styles",items:["Styles","Format","Font","FontSize"]}]:[],e.enterMode=CKEDITOR.ENTER_BR,e.removePlugins="elementspath",e.resize_enabled=!1,e.uiColor="#3071a9",e.skin="office2013",e.extraPlugins="confighelper,autogrow",e.image_previewText="Nội dung của bạn",e.language="vi",!isNaN(g)&&g>0&&(e.height=g,e.autoGrow_minHeight=g),f&&(e.height=70,e.autoGrow_minHeight=70,e.removePlugins="toolbar,elementspath",e.resize_enabled=!1);var h=CKEDITOR.replace(b[0],e);d&&(h.on("pasteState",function(){a.$apply(function(){d.$setViewValue(h.getData())})}),d.$render=function(){h.setData(d.$viewValue)},a.$on("$destroy",function(){h.removeAllListeners(),CKEDITOR.remove(h)}))}}}]).directive("fixOnScroll",["$window","$timeout",function(a,b){return{restrict:"A",link:function(c,d,e){b(function(){var b=angular.element(a),c=Number(e.fixOnScroll),f=d.offset().top;b.bind("scroll",function(){b.scrollTop()>=f-d.outerHeight()&&(d.css("position","fixed"),d.css("top",c)),b.scrollTop()<=f-d.outerHeight()&&d.css("position","static")})},1e3)}}}]).directive("imgEdit",["$timeout",function(a){return{restrict:"A",scope:{imgSrc:"=",texts:"=",output:"="},link:function(b,c){function d(){h&&a(function(){b.output=h.canvas.toDataURL("image/jpeg")})}function e(a){if(h){for(var b=0;b<a.length;b++){var c=a[b];if(j[b])j[b].text=c?c.content:"Chữ ở dưới";else{j[b]=new createjs.Text("","bold 40px Arial","#ffffff");var d=c.position;d&&(d.top&&(j[b].y=d.top,j[b].top=d.top),d.bottom&&(j[b].y=h.canvas.height-d.bottom,j[b].bottom=d.bottom),d.left&&(j[b].x=d.left,j[b].left=d.left),d.right&&(j[b].x=h.canvas.width-d.right,j[b].right=d.right));var e=c.width;e&&(j[b].lineWidth=e),j[b].shadow=new createjs.Shadow("#000000",0,0,10),j[b].textAlign="center",j[b].text=c?c.content:"Chữ ở trên",j[b].cursor="pointer",f(j[b]),h.addChild(j[b])}}h.update()}}function f(a){a.addEventListener("mousedown",function(b){var c={x:a.x-b.stageX,y:a.y-b.stageY};a.addEventListener("pressmove",function(b){h.addChild(a),a.x=b.stageX+c.x,a.y=b.stageY+c.y,h.update()})}),a.addEventListener("pressup",function(){d()})}function g(){h&&h.update()}var h,i=new Image,j=[];i.onload=function(){var a=c[0],b=i.width*(600/i.width),d=i.height*(600/i.width);a.width=b,a.height=d,h=new createjs.Stage(a);var e=new createjs.Bitmap(event.target);if(e.scaleX=e.scaleY=600/i.width,h.addChild(e),j.length>0)for(var f=0;f<j.length;f++)j[f].top&&(j[f].y=j[f].top),j[f].bottom&&(j[f].y=h.canvas.height-j[f].bottom),j[f].left&&(j[f].x=j[f].left),j[f].right&&(j[f].x=h.canvas.width-j[f].right),h.addChild(j[f]);h.enableMouseOver(10),h.update()},b.$watch("texts",function(a){e(a),d()},!0),b.$watch("imgSrc",function(a){i.src=a,d()}),createjs.Ticker.setFPS(40),createjs.Ticker.addEventListener("tick",g)}}}]).directive("fileDrag",["$timeout",function(){return{restrict:"A",scope:{onFileSelect:"="},link:function(a,b){function c(a){a.stopPropagation(),a.preventDefault(),"dragover"===a.type?b.addClass("hover"):b.removeClass("hover")}function d(b){c(b);var d=b.target.files||b.dataTransfer.files;a.onFileSelect(d)}b[0].addEventListener("dragover",c,!1),b[0].addEventListener("dragleave",c,!1),b[0].addEventListener("drop",d,!1)}}}])}(),function(){"use strict";angular.module("KApp").filter("emoticons",["mainSrv",function(a){var b=a.getEmoticonsList();return function(a){if(b&&a){for(var c=a,d=0;d<b.length;d++){var e=b[d].shortcut;e&&(c=c.split(e).join("<img src="+b[d].path+">"))}return c}return a}}])}(),function(){"use strict";function a(a){return"function"==typeof a}function b(b,c,d){function e(b,c){for(var e=0,f=d.length;f>e;e++){var g=a(b[d[e]])?b[d[e]](b):b[d[e]],h=a(c[d[e]])?c[d[e]](c):c[d[e]];if(g!==h||e===f-1)return g!==h&&e!==f-1?h>g?-1:1:h>g?-1:g>h?1:0}}c=c?c:"asc",b.sort(function(a,b){return"asc"===c?e(a,b):e(b,a)})}var c={};c.millisecondsToSeconds=function(a){return a/=1e3,Math.floor(a%60)},c.millisecondsToMinutes=function(a){return a/=1e3,a/=60,Math.floor(a%60)},c.millisecondsToHours=function(a){return a/=1e3,a/=60,a/=60,Math.floor(a%24)},c.millisecondsToDays=function(a){return a/=1e3,a/=60,a/=60,a/=24,Math.floor(a)},c.multiSort=b,c.isFunction=a,window.kt=c}(),angular.module("KApp").controller("UserHomeCtrl",["$scope","$http","mainSrv",function(a,b,c){var d={};c.checkLogin(function(){d.currentUser=c.getCurrentUser()}),a.user=d}]),function(){angular.module("KApp").run(["$anchorScroll",function(a){a.yOffset=50}]).directive("video",function(){return{restrict:"E",link:function(a,b){var c=b.parent(),d=c.find(".play-button");d&&d.show(),b.mouseover(function(){b.get(0).paused&&(d&&d.hide(),b.get(0).play())}),c.on("click",function(){b.get(0).paused?(d&&d.hide(),b.get(0).play()):(d&&d.show(),b.get(0).pause())})}}}).controller("QuestionHomeCtrl",["$scope","$http","$routeParams","$timeout","mainSrv","$upload","$anchorScroll","$location",function(a,b,c,d,e,f,g,h){function i(a){l.postError=!0,l.postErrorMsg=a,l.posting=!1,d(function(){var a="post-error";h.hash()!==a?h.hash("post-error"):g()})}function j(){var a="ask-now-btn";h.hash()!==a?h.hash(a):g()}function k(c){return c&&(l.model.media=c),c||l.model.content&&!(l.model.title.trim().length<32)?("member"===l.postingIdentity&&b.post("/api/posts/member/create",angular.toJson(l.model)).success(function(){l.showPostSuccess=!0;var b=d(function(){l.showPostSuccess=!1,d.cancel(b),b=null},3e3);l.closePostForm(),a.$broadcast("GET_NEWEST_QUESTION")}).error(function(a){i(a)}).finally(function(){l.posting=!1}),void("anonymous"===l.postingIdentity&&b.post("/api/posts/public/create",angular.toJson(l.model)).success(function(b){if("SUCCESS"===b.status){l.showPostSuccess=!0;var c=d(function(){l.showPostSuccess=!1,d.cancel(c),c=null},2e3);l.closePostForm(),a.$broadcast("GET_NEWEST_QUESTION")}}).error(function(a){i(a)}).finally(function(){l.posting=!1}))):void i("Bài viết không có hình ảnh phải có độ dài 32 ký tự trở lên !")}var l={},m={title:"",content:"",media:null};l.postingIdentity="member";var n={viewAll:{template:"/ui/scripts/questions/templates/questions.multiple.template.html"},viewSingle:{template:"/ui/scripts/questions/templates/questions.single.template.html"}},o=c.questionId;l.currentMode=o&&-1===o.indexOf("_=_")?n.viewSingle:n.viewAll,l.model=angular.copy(m),l.currentUser=e.getCurrentUser(),l.list=[],l.dataUrls=[];var p;l.onFileSelect=function(a){p=a;var b=new FileReader;b.readAsDataURL(a[0]),b.onload=function(a){d(function(){l.dataUrls[0]=a.target.result})}},a.$on("WANT_TO_POST",j),l.post=function(){return l.model.title&&""!==l.model.title.trim()?(l.posting=!0,void(p&&p[0]?f.upload({url:"/api/files/images/upload",method:"post",headers:{"my-header":"my-header-value"},data:{myModel:"",errorCode:500,errorMessage:"Error"},file:p[0],fileFormDataName:"myFile"}).then(function(a){var b=a.data.data;k(b)},function(a){i(a.data)}):k())):void i("Tiêu đề bài viết không thể để trống !")},l.showPostForm=function(){l.isPostFormShown=!0,e.checkLogin(function(){l.currentUser=e.getCurrentUser(),l.postingIdentity=l.currentUser?"member":"anonymous"})},l.closePostForm=function(){l.isPostFormShown=!1},l.getTopUsers=function(a){b.get("/api/users/top/"+a).success(function(a){l.topUsers=a.data})},l.recommendedPosts=[],l.getRecommendedPosts=function(){var a="/api/posts/public/random?number=10";b.get(a).success(function(a){angular.forEach(a.data,function(a){l.recommendedPosts.push(a)})})},l.getRecommendedPosts(),a.questions=l}])}(),function(){"use strict";function a(a,b,c,d,e,f,g){function h(a){if(N.currentUser){var b=N.currentUser.info.followingPosts;angular.forEach(a,function(a){a.ratingStatus=D(a),a.marked=!1,angular.forEach(b,function(b){a._id===b&&(a.marked=!0)})})}}function i(a){var b=new Date(a),c=new Date,d=6e4,f=36e5,g=864e5,h=6048e5,i=c-b;return d>=i?kt.millisecondsToSeconds(i)+" giây trước":f>=i?kt.millisecondsToMinutes(i)+" phút trước":g>=c-b?kt.millisecondsToHours(i)+" giờ trước":h>=i?kt.millisecondsToDays(i)+" ngày trước":e("date")(a,"M/d/y")}function j(a){for(var b=new Date(a[0].createdDate),c=1,d=a.length;d>c;c++){var e=new Date(a[c].createdDate);b>e&&(b=e)}return b}function k(a){for(var b=new Date(a[0].createdDate),c=1,d=a.length;d>c;c++){var e=new Date(a[c].createdDate);e>b&&(b=e)}return b}function l(){if(!P){P=!0;var a="/api/posts/public/time?timestamp="+M.getTime()+"&limit="+K+"&query=old";O&&(a+="&category="+O),b.get(a).success(function(a){angular.forEach(a.data,function(a){N.list.push(a)}),N.list.length>0&&(M=j(N.list)),h(N.list),N.loadingMore=!1,g(function(){"undefined"!=typeof FB&&FB.XFBML.parse()})}).finally(function(){P=!1})}}function m(a){for(var c="/api/posts/public?page="+J+"&num="+K+"&query=old",d=0;d<a.length;d++)c+="&"+a[d].key+"="+a[d].value;b.get(c).success(function(a){angular.forEach(a.data,function(a){N.list.push(a)}),h(N.list),N.loadingMore=!1})}function n(){b.get("/api/posts/public/time?timestamp="+L.getTime()+"&limit=0&query=new").success(function(a){if(a.data&&a.data.length>0){for(var b=a.data.length-1;b>=0;b--)N.list.unshift(a.data[b]);N.list.length>0&&(L=k(N.list)),h(N.list),N.loadingMore=!1}})}function o(){b.get("/api/posts/public/following").success(function(a){N.list=a.data,kt.multiSort(N.list,"desc",["state","createdDate"]),h(N.list)})}function p(){b.get("/api/posts/public/all").success(function(a){N.list=a.data})}function q(){N.currentViewMode===N.VIEW_MODES.ALL_TIME_LINE?(N.loadingMore=!0,N.getOlderPosts()):N.currentViewMode===N.VIEW_MODES.ALL_TOP_COMMENTS&&(N.loadingMore=!0,J++,m([{key:"sort_by",value:"commentCount"}]))}function r(){N.currentViewMode!==I.ALL_TOP_COMMENTS&&(J=1,N.list=[],N.currentViewMode=I.ALL_TOP_COMMENTS,m([{key:"sort_by",value:"commentCount"}]))}function s(){N.currentViewMode!==I.ALL_TIME_LINE&&(N.list=[],N.currentViewMode=I.ALL_TIME_LINE,M=new Date,l())}function t(){N.currentViewMode!==I.FOLLOWING_NEW_UPDATE&&(N.list=[],N.currentViewMode=I.FOLLOWING_NEW_UPDATE,o())}function u(){N.currentViewMode!==I.ALL&&(N.list=[],N.currentViewMode=I.ALL,p())}function v(a){if(N.currentUser){for(var c=N.currentUser.info.followingPosts,d=0;d<c.length;d++)if(c[d]===a._id)return;N.currentUser.info.followingPosts.push(a._id),a.marked=!0,b.get("/api/users/follow/"+a._id)}}function w(a){if(N.currentUser)for(var c=N.currentUser.info.followingPosts,d=0;d<c.length;d++)if(c[d]===a._id)return N.currentUser.info.followingPosts.splice(d,1),a.marked=!1,void b.get("/api/users/unfollow/"+a._id)}function x(){d.url("/new")}function y(){d.url("/hot")}function z(){d.url("/following")}function A(a){return a?a.google?a.google.name:a.facebook?a.facebook.name:a.local?a.local.name:"":"Nặc Danh"}function B(a){FB.ui({method:"share",href:"http://cuoithaga.com/view/"+a.link},function(){})}function C(a){FB.ui({method:"share_open_graph",action_type:"og.like",action_properties:JSON.stringify({object:"http://cuoithaga.com/view/"+a.link})},function(){})}function D(a){if(N.currentUser){for(var b=0,c=a.goodRatings.length;c>b;b++)if(a.goodRatings[b].from===N.currentUser.info._id)return N.GOOD;for(var d=0,e=a.badRatings.length;e>d;d++)if(a.badRatings[d].from===N.currentUser.info._id)return N.BAD}return N.NEGATIVE}function E(a){a.ratingStatus=D(a);for(var b=0;b<N.list.length;b++)N.list[b]._id===a._id&&(N.list[b]=a)}function F(a){var c={id:a._id};b.post("/api/posts/rate/good",angular.toJson(c)).success(function(a){E(a.data)})}function G(a){var c={id:a._id};b.post("/api/posts/rate/bad",angular.toJson(c)).success(function(a){E(a.data)})}function H(a){var c={id:a._id};b.post("/api/posts/unrate",angular.toJson(c)).success(function(a){E(a.data)})}var I={ALL_TIME_LINE:0,ALL_TOP_COMMENTS:1,FOLLOWING_NEW_UPDATE:2,ALL:3},J=1,K=4,L=new Date,M=new Date,N={VIEW_MODES:I,loadingMore:!1,currentViewMode:void 0,currentUser:c.getCurrentUser(),list:[],GOOD:1,BAD:-1,NEGATIVE:0},O=null,P=!1;N.like=C,N.share=B,N.unRateQuestion=H,N.rateBadQuestion=G,N.rateGoodQuestion=F,N.getDate=i,N.getName=A,N.viewTimeLine=s,N.viewFollowingPosts=t,N.viewTimeLineWithTopComments=r,N.viewNew=x,N.viewHot=y,N.viewFollowing=z,N.loadMore=q,N.followPost=v,N.unFollowPost=w,N.getOlderPosts=l,N.getNewPosts=n,a.app=N;var Q=f.viewMode;a.$emit("VIEW_MODE_CHANGED",Q),"hot"===Q?r():"following"===Q?t():"new"===Q?s():"all"===Q?u():"girl"===Q?(O="girl",s()):"boy"===Q?(O="boy",s()):s(),a.$emit("TITLE_CHANGED","Xả Stress"),a.$emit("REFRESH"),a.$on("GET_NEWEST_QUESTION",function(){N.getNewPosts()})}angular.module("KApp").controller("QuestionsMultipleCtrl",["$scope","$http","mainSrv","$location","$filter","$routeParams","$timeout",a])}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){function i(a){if(m.currentUser){for(var b=0,c=a.goodRatings.length;c>b;b++)if(a.goodRatings[b].from===m.currentUser.info._id)return m.GOOD;for(var d=0,e=a.badRatings.length;e>d;d++)if(a.badRatings[d].from===m.currentUser.info._id)return m.BAD}return m.NEGATIVE}function j(a){var b=new Date(a),c=new Date,d=6e4,e=36e5,f=864e5,h=6048e5,i=c-b;return d>=i?kt.millisecondsToSeconds(i)+" giây trước":e>=i?kt.millisecondsToMinutes(i)+" phút trước":f>=c-b?kt.millisecondsToHours(i)+" giờ trước":h>=i?kt.millisecondsToDays(i)+" ngày trước":g("date")(a,"M/d/y")}function k(){o++,m.getComments()}function l(a){a.ratingStatus=i(a);for(var b=0;b<m.comments.length;b++)m.comments[b]._id===a._id&&(m.comments[b]=a)}var m={},n={content:"",toPost:""},o=1,p=10;m.GOOD=1,m.BAD=-1,m.NEGATIVE=0,m.ratingStatus=m.NEGATIVE,m.data={},m.comments=[],m.commentModel=angular.copy(n);var q=c.questionId;m.getById=function(){b.get("/api/posts/public/single/"+q).success(function(b){m.data=b.data,m.ratingStatus=i(m.data.post),m.data.post.media&&(m.youtubeUrl=h.trustAsResourceUrl("https://www.youtube.com/embed/"+m.data.post.media.youtubeId)),a.$emit("TITLE_CHANGED",m.data.post.title),d(function(){FB&&FB.XFBML.parse()})}).error(function(){f.url("/")})},m.showQCommentForm=function(){m.currentUser?(m.currentUser=e.getCurrentUser(),m.qCommentForm=!0):m.showCommentError=!0},m.closeQCommentForm=function(){m.qCommentForm=!1},m.postComment=function(){m.commentModel.toPost=q,b.post("/api/comments",angular.toJson(m.commentModel)).success(function(){m.showCommentSuccess=!0,m.qCommentForm=!1;var a=d(function(){m.showCommentSuccess=!1,d.cancel(a),a=null},3e3);m.getComments(),m.getById()}).error(function(){m.showCommentError=!0})},m.getComments=function(){m.loadingMoreComments=!0,b.get("api/comments/"+q+"?page="+o+"&limit="+p).success(function(a){angular.forEach(a.data,function(a){a.ratingStatus=i(a),m.comments.push(a)}),m.loadingMoreComments=!1})},m.rateGoodQuestion=function(){var a={id:m.data.post._id};b.post("/api/posts/rate/good",angular.toJson(a)).success(function(){m.getById()})},m.rateBadQuestion=function(){var a={id:m.data.post._id};b.post("/api/posts/rate/bad",angular.toJson(a)).success(function(){m.getById()})},m.unRateQuestion=function(){var a={id:m.data.post._id};b.post("/api/posts/unrate",angular.toJson(a)).success(function(){m.getById()})},m.rateGoodComment=function(a){var c={id:a._id};b.post("/api/comments/rate/good",angular.toJson(c)).success(function(a){l(a.data)})},m.rateBadComment=function(a){var c={postId:m.data.post._id,id:a._id};b.post("/api/comments/rate/bad",angular.toJson(c)).success(function(a){l(a.data)})},m.unRateComment=function(a){var c={id:a._id};b.post("/api/comments/unrate",angular.toJson(c)).success(function(a){l(a.data)})},m.getAva=function(a){return a?a.google?a.google.picture:a.facebook?"https://graph.facebook.com/"+a.facebook.id+"/picture?width=200&height=200&access_token="+a.facebook.token:"/ui/images/icons/dialog_question.png":"/ui/images/icons/nacdanh.png"},m.getName=function(a){return a?a.google?a.google.name:a.facebook?a.facebook.name:a.local?a.local.name:"":"Nặc Danh"},m.goToNextPost=function(){b.get("/api/posts/public/next/"+m.data.post._id).success(function(a){a.data&&a.data.link&&f.url("/view/"+a.data.link)}).error(function(a){console.log(a)})},e.checkLogin(function(){m.currentUser=e.getCurrentUser(),m.currentUser&&(m.qCommentForm=!0),m.getById()}),m.getDate=j,m.loadMoreComments=k,a.question=m,m.share=function(a){FB.ui({method:"share",href:"http://cuoithaga.com/view/"+a.link},function(){})},a.$emit("REFRESH")}angular.module("KApp").controller("QuestionsSingleCtrl",["$scope","$http","$routeParams","$timeout","mainSrv","$location","$filter","$sce",a])}(),function(){"use strict";function a(a,b){var c={};c.list=[],b.get("/api/memes").success(function(a){c.list=a.data}),a.imageHome=c}angular.module("KApp").controller("ImageHomeCtrl",["$scope","$http",a])}(),function(){"use strict";function a(a,b,c,d){var e={},f=d.memeId;e.texts=[{content:"",position:{top:5,left:300},width:580},{content:"",position:{bottom:45,left:300},width:580}],b.get("/api/memes/"+f).success(function(a){e.input=a.data.path,e.textTop=a.data.topText,e.textBottom=a.data.bottomText}),e.dataUrls=[];var g;e.onFileSelect=function(a){g=a;var b=new FileReader;b.readAsDataURL(a[0]),b.onload=function(a){c(function(){e.input=a.target.result})}},a.image=e}angular.module("KApp").controller("ImageEditCtrl",["$scope","$http","$timeout","$routeParams",a])}(),function(){"use strict";angular.module("KApp").controller("AdminCpCtrl",["$scope","$http","mainSrv",function(a,b,c){var d={};d.currentMenu={},d.currentLoginInfo={username:"admin",password:""},d.menu=[{id:"usersMng",title:"Manage Users",templateUrl:"/ui/scripts/admin-cp/templates/admincp.users.template.html",iconClass:"fa fa-lg fa-group"},{id:"postMng",title:"Manage Questions",templateUrl:"/ui/scripts/admin-cp/templates/admincp.posts.template.html",iconClass:"fa fa-lg fa-edit"},{id:"cmtMng",title:"Manage Comments",templateUrl:"/ui/scripts/admin-cp/templates/admincp.comments.template.html",iconClass:"fa fa-lg fa-comment"},{id:"emoMng",title:"Manage Emoticons",templateUrl:"/ui/scripts/admin-cp/templates/admincp.emoticons.template.html",iconClass:"fa fa-lg fa-smile-o"},{id:"memeMng",title:"Manage Memes",templateUrl:"/ui/scripts/admin-cp/templates/admincp.memes.template.html",iconClass:"fa fa-lg fa-smile-o"},{id:"roleMng",title:"Manage Roles",templateUrl:"/ui/scripts/admin-cp/templates/admincp.roles.template.html",iconClass:"fa fa-lg fa-group"}],d.currentMenu=d.menu[0],d.onMenuClick=function(a){d.currentMenu=a},d.checkLogin=function(){b.get("/api/profile").success(function(b){if("SUCCESS"===b.status){var e=b.data.info;d.isAdmin=e.root||e.role.name.indexOf("admin")>-1,c.setCurrentUser(b.data),a.$emit("LOGGED_IN",e)}else d.isAdmin=!1}).error(function(a){console.log(a)})},d.login=function(){b.post("/api/users/login",angular.toJson(d.currentLoginInfo)).success(function(){d.currentLoginInfo={},d.checkLogin()}).error(function(){d.checkLogin()})},d.checkLogin(),a.$on("LOGGED_OUT",d.checkLogin),a.adminCp=d}])}(),function(){"use strict";function a(a,b,c,d,e,f){function g(a,b){c.pop("error","Error: "+b,a)}function h(){b.get("/api/users").success(function(a){q.list=a.data,s.reload()}).error(g)}function i(a){q.currentMode=a}function j(){b.get("/api/roles").success(function(a){q.rolesList=a.data})}function k(a){q.currentUserObj=a,i(q.EDITING)}function l(){var a={_id:q.currentUserObj._id,role:q.currentUserObj.role._id,local:q.currentUserObj.local?{email:q.currentUserObj.local.email,name:q.currentUserObj.local.name,username:q.currentUserObj.local.username}:null};b.put("/api/users",angular.toJson(a)).success(function(){c.pop("success","Success","Updated User successfully",3e3),h(),i(q.VIEWING)}).error(g)}function m(){b.post("/api/users",angular.toJson(q.currentRegisterObj)).success(function(){c.pop("success","Success","Created User successfully",3e3),q.currentRegisterObj=angular.copy(r),h(),i(q.VIEWING)}).error(g)}function n(e){d.showConfirmDialog(a,"Xác Nhận","Có chắc muốn xóa người dùng này không ?",function(){b.delete("/api/users/"+e._id).success(function(){c.pop("success","Success","Deleted User successfully",3e3),h()}).error(g)})}function o(){q.editingPassword=!1,q.currentUserObj.password=""}function p(){if(q.currentUserObj.password){var a={_id:q.currentUserObj._id,password:q.currentUserObj.password};b.put("/api/users/password",angular.toJson(a)).success(function(){o()}).error(g)}}var q={VIEWING:0,CREATING:1,EDITING:2},r={username:"",password:"",email:"",displayName:""},s=new f({page:1,count:10,sorting:{rating:"asc"}},{total:0,getData:function(a,b){var c=q.list||[],f=b.sorting()?e("orderBy")(c,b.orderBy()):c,g=b.filter(),h=b.filter()?d.poweredFilter(f,g):f;b.total(c.length),a.resolve(h.slice((b.page()-1)*b.count(),b.page()*b.count()))}});h(),j(),q.currentMode=q.VIEWING,q.tableParams=s,q.currentRegisterObj=angular.copy(r),q.changeMode=i,q.getAll=h,q.loadEditForm=k,q.editUser=l,q.createUser=m,q.deleteUser=n,q.changePassword=p,q.resetEditingPassword=o,a.users=q}angular.module("KApp").controller("UsersAdminCtrl",["$scope","$http","toaster","$kUtil","$filter","ngTableParams",a])}(),function(){"use strict";angular.module("KApp").controller("PostsCtrl",["$scope","$http","$upload","$timeout","$filter","$kUtil","ngTableParams","toaster",function(a,b,c,d,e,f,g,h){function i(a,b){h.pop("error","Error: "+b,a)}var j={};j.VIEWING=0,j.CREATING=1,j.EDITING=2,j.CATEGORY_TYPES=[{name:"Vui Nhộn",key:"funny"},{name:"Gái Xinh",key:"girl"},{name:"Trai Đẹp",key:"boy"}],j.DEFAULT_OBJ={title:"",content:"",category:j.CATEGORY_TYPES[0].key},j.currentMode=j.VIEWING,j.list=[],j.currentObj=angular.copy(j.DEFAULT_OBJ),j.languages=[{key:"en",display:"English"},{key:"vi",display:"Vietnamese"}],j.tableParams=new g({page:1,count:10,sorting:{rating:"asc"}},{total:0,getData:function(a,b){var c=b.sorting()?e("orderBy")(j.list,b.orderBy()):j.list,d=b.filter(),g=b.filter()?f.poweredFilter(c,d):c;b.total(j.list.length),a.resolve(g.slice((b.page()-1)*b.count(),b.page()*b.count()))}}),j.getAll=function(){j.loading=!0,b.get("/api/posts/manage/all").success(function(a){j.list=a.data,j.tableParams.reload()}).error(i)},j.addTranslation=function(){j.requestData.data.push({content:"",summary:"",title:"",language:"en"})},j.editPost=function(){b.put("/api/posts/manage/update",angular.toJson(j.currentObj)).success(function(){h.pop("success","Success","Updated question successfully",3e3),j.changeMode(j.VIEWING),j.getAll()}).error(i)},j.deletePost=function(c){f.showConfirmDialog(a,"Xác Nhận","Có chắc muốn xóa bài này không ?",function(){b.delete("/api/posts/manage/delete/"+c._id).success(function(){h.pop("success","Success","Deleted question successfully",3e3),j.changeMode(j.VIEWING),j.getAll()}).error(i)})},j.banPost=function(a){b.get("/api/posts/manage/ban/"+a._id).success(function(){h.pop("success","Success","Ban question successfully",3e3),j.changeMode(j.VIEWING),j.getAll()}).error(i)},j.allowPost=function(a){b.get("/api/posts/manage/allow/"+a._id).success(function(){h.pop("success","Success","Allow question successfully",3e3),j.changeMode(j.VIEWING),j.getAll()}).error(i)},j.changeMode=function(a){j.currentMode=a},j.loadEditForm=function(a){a&&(j.currentObj._id=a._id,j.currentObj.title=a.title,j.currentObj.link=a.link,j.currentObj.content=a.content,j.changeMode(j.EDITING))},j.getAll(),a.posts=j}])}(),function(){"use strict";angular.module("KApp").controller("EmoCtrl",["$scope","$http","$upload","ngTableParams","$filter","$kUtil","toaster","$q",function(a,b,c,d,e,f,g,h){function i(a,b){g.pop("error","Error: "+b,a)}var j,k={};k.onFileSelect=function(a){j=a},k.startUpload=function(){k.uploading=!0;var a=[];angular.forEach(j,function(b){var d=c.upload({url:"/api/emoticons/upload",method:"post",headers:{"my-header":"my-header-value"},data:{myModel:"",errorCode:500,errorMessage:"An Error occur(custom)"},file:b,fileFormDataName:"myFile"}).error(i);
a.push(d)}),h.all(a).finally(function(){k.uploading=!1})},k.tableParams=new d({page:1,count:10,sorting:{rating:"asc"}},{total:0,getData:function(a,b){var c=k.list||[],d=b.sorting()?e("orderBy")(c,b.orderBy()):c,g=b.filter(),h=b.filter()?f.poweredFilter(d,g):d;b.total(c.length),a.resolve(h.slice((b.page()-1)*b.count(),b.page()*b.count()))}}),k.getAll=function(){b.get("/api/emoticons").success(function(a){k.list=a.data,k.tableParams.reload()}).error(i)},k.deleteEmo=function(c){f.showConfirmDialog(a,"Xác Nhận","Có chắc muốn xóa emo này không ?",function(){b.delete("/api/emoticons/"+c._id).success(function(){g.pop("success","Success","Deleted emoticon successfully",3e3),k.getAll()}).error(i)})},k.updateEmo=function(a){var c={id:a._id,name:a.name,shortcut:a.shortcut};b.put("/api/emoticons",angular.toJson(c)).success(function(){g.pop("success","Success","Updated emoticon successfully",3e3)}).error(i)},k.getAll(),a.emo=k}])}(),function(){"use strict";angular.module("KApp").controller("RolesManageCtrl",["$scope","$http","$upload","$timeout",function(a,b){function c(){b.get("/api/roles").success(function(a){j.list=a.data})}function d(a,b){for(var c=0;c<a.permissions.length;c++)if(a.permissions[c].resourceName===b){for(var d="",e=0;e<a.permissions[c].can.length;e++)a.permissions[c].can[e].allow&&(d+=a.permissions[c].can[e].action+", ");if(""!==d)return d}return"N/A"}function e(a){j.currentMode=a}function f(){b.post("/api/roles",angular.toJson(j.currentRequestObj)).success(function(){e(j.VIEWING),c(),j.currentRequestObj=angular.copy(j.REQUEST_OBJ_DEFAULT)})}function g(a){j.currentRequestObj=angular.copy(a),e(j.EDITING)}function h(){b.put("/api/roles",angular.toJson(j.currentRequestObj)).success(function(){e(j.VIEWING),c(),j.currentRequestObj=angular.copy(j.REQUEST_OBJ_DEFAULT)})}function i(){var a="";j.currentRequestObj.permissions.push({resourceName:a,can:[{action:"create",allow:!0},{action:"update",allow:!0},{action:"delete",allow:!0},{action:"read",allow:!0},{action:"update_mine",allow:!0},{action:"delete_mine",allow:!0},{action:"read_mine",allow:!0},{action:"read_aio",allow:!0}]})}var j={VIEWING:0,CREATING:1,EDITING:2,RESOURCES:[{name:"Post",key:"post"},{name:"Comment",key:"comment"},{name:"User",key:"user"},{name:"Role",key:"role"},{name:"Emoticons",key:"emoticon"},{name:"Memes",key:"meme"}],PERMISSIONS:[{name:"Create",key:"c"},{name:"Update",key:"u"},{name:"Delete",key:"d"},{name:"Read",key:"r"}],REQUEST_OBJ_DEFAULT:{name:"admin1",permissions:[{resourceName:"post",can:[{action:"create",allow:!0},{action:"update",allow:!0},{action:"delete",allow:!0},{action:"read",allow:!0},{action:"update_mine",allow:!0},{action:"delete_mine",allow:!0},{action:"read_mine",allow:!0},{action:"read_aio",allow:!0}]}]}};c(),j.currentRequestObj=angular.copy(j.REQUEST_OBJ_DEFAULT),j.currentMode=j.VIEWING,j.changeMode=e,j.getAll=c,j.getPermissions=d,j.createRole=f,j.addResource=i,j.loadEditForm=g,j.updateRole=h,a.roles=j}])}(),function(){"use strict";angular.module("KApp").controller("CommentsAdminCtrl",["$scope","$http","$upload","$timeout","ngTableParams","$filter","$parse","$kUtil","toaster",function(a,b,c,d,e,f,g,h,i){function j(a,b){i.pop("error","Error: "+b,a)}var k={};k.VIEWING=0,k.CREATING=1,k.EDITING=2,k.DEFAULT_OBJ={content:""},k.currentMode=k.VIEWING,k.list=[],k.currentObj=angular.copy(k.DEFAULT_OBJ),k.languages=[{key:"en",display:"English"},{key:"vi",display:"Vietnamese"}],k.getAll=function(){b.get("/api/comments").success(function(a){k.list=a.data,k.tableParams.reload()}).error(j)},k.tableParams=new e({page:1,count:10,sorting:{rating:"asc"}},{total:0,getData:function(a,b){var c=b.sorting()?f("orderBy")(k.list,b.orderBy()):k.list,d=b.filter(),e=b.filter()?h.poweredFilter(c,d):c;b.total(k.list.length),a.resolve(e.slice((b.page()-1)*b.count(),b.page()*b.count()))}}),k.editComment=function(){b.put("/api/comments",angular.toJson(k.currentObj)).success(function(){i.pop("success","Success","Updated comment successfully",3e3),k.changeMode(k.VIEWING),k.getAll()}).error(j)},k.deleteComment=function(c){h.showConfirmDialog(a,"Xác Nhận","Có chắc muốn xóa bình luận này không ?",function(){b.delete("/api/comments/delete/"+c._id).success(function(){k.getAll()}).error(j)})},k.changeMode=function(a){k.currentMode=a},k.loadEditForm=function(a){a&&(k.currentObj._id=a._id,k.currentObj.content=a.content,k.changeMode(k.EDITING))},k.getAll(),a.comments=k}])}(),function(){"use strict";angular.module("KApp").controller("MemeManageCtrl",["$scope","$http","$upload","ngTableParams","$filter","$kUtil","toaster","$q",function(a,b,c,d,e,f,g,h){function i(a,b){g.pop("error","Error: "+b,a)}var j,k={};k.onFileSelect=function(a){j=a},k.startUpload=function(){k.uploading=!0;var a=[];angular.forEach(j,function(b){var d=c.upload({url:"/api/memes/upload",method:"post",headers:{"my-header":"my-header-value"},data:{myModel:"",errorCode:500,errorMessage:"An Error occur(custom)"},file:b,fileFormDataName:"myFile"}).error(i);a.push(d)}),h.all(a).finally(function(){k.uploading=!1})},k.tableParams=new d({page:1,count:10,sorting:{rating:"asc"}},{total:0,getData:function(a,b){var c=k.list||[],d=b.sorting()?e("orderBy")(c,b.orderBy()):c,g=b.filter(),h=b.filter()?f.poweredFilter(d,g):d;b.total(c.length),a.resolve(h.slice((b.page()-1)*b.count(),b.page()*b.count()))}}),k.getAll=function(){b.get("/api/memes").success(function(a){k.list=a.data,k.tableParams.reload()}).error(i)},k.deleteEmo=function(c){f.showConfirmDialog(a,"Xác Nhận","Có chắc muốn xóa meme dùng này không ?",function(){b.delete("/api/memes/"+c._id).success(function(){g.pop("success","Success","Deleted emoticon successfully",3e3),k.getAll()}).error(i)})},k.updateEmo=function(a){var c={id:a._id,name:a.name,description:a.description,topText:a.topText,bottomText:a.bottomText};b.put("/api/memes",angular.toJson(c)).success(function(){g.pop("success","Success","Updated emoticon successfully",3e3)}).error(i)},k.getAll(),a.meme=k}])}();